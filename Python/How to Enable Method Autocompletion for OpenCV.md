# How to Enable Method Autocompletion for OpenCV

## 1. Introduction

In Python, some packages are written mainly or partially in C++, and the Python interfaces are just wrappers around the binary C++ module. Among these packages, there is [OpenCV](https://github.com/opencv/opencv).

When I use [python-lsp-server](https://github.com/python-lsp/python-lsp-server) or [pyright](https://github.com/microsoft/pyright) with Neovim[^1], I can not get method completion for the OpenCV package. This is because the OpenCV projects is developed using C++ and does not have stub files[^2] shipped yet.

## 2. Using stub file from project python-type-stubs

Fortunately, the project [python-type-stubs](https://github.com/microsoft/python-type-stubs/tree/main/cv2) provides stub files for several projects including OpenCV. To use the stub file, first find where OpenCV is installed on your system:

```fallback
python -c 'import os, cv2; print(os.path.dirname(cv2.__file__))'
```

Then download the stub file and put it in the same directory as OpenCV.

```fallback
curl -sSL https://raw.githubusercontent.com/microsoft/python-type-stubs/main/cv2/__init__.pyi \
    -o path/to/opencv/directory/__init__.pyi
```

Then restart nvim, the auto-completion for OpenCV should work as expected.

## 3. Using `stubgen`

We can also use `stubgen` to generate the stub files, like this:

```fallback
# stubgen is installed via mypy package
pip install -U mypy

stubgen -m cv2
```

The stub file will be saved under the `out/` directory. However, the stub file generated by stubgen lacks doc and is not as good as stub file provided by project python-type-stubs.

For more info on using stubgen, visit [its page](https://mypy.readthedocs.io/en/stable/stubgen.html).

## References

> - what is the use of stub files in Python: https://stackoverflow.com/q/59051631/6064933
>
> - relevant issue on OpenCV repo: https://github.com/opencv/opencv/issues/14590
>
> - discussion on pylance repo: https://github.com/microsoft/pylance-release/issues/138#issuecomment-874363285
>
> - https://jdhao.github.io/2022/11/16/auto_completion_opencv/

---

[^1]: you can check my nvim LSP config [here](https://github.com/jdhao/nvim-config/blob/8b10be60d45f2505d1f6962014640a123b814614/lua/config/lsp.lua#L101).
[^2]: https://peps.python.org/pep-0484/#stub-files