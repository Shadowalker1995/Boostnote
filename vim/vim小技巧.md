# vim 小技巧

## 在一个字符前后各添加一个空格

对于以下代码

`var foo = "method("+argument1+","+argument2+")"`

- `/+<Esc>` 	查找所有的“+”
- `cl<Space>+<Space><Esc>`    将第一个“+”修改为“ + ”
- `=.`    重复上次操作

## 可重复操作及如何回退

| 目的                     | 操作                      | 重复 | 回退 |
| ------------------------ | ------------------------- | ---- | ---- |
| 做出一个修改             | `{edit}`                  | `.`  | `u`  |
| 在行内查找下一个指定字符 | `f{char}`/`t{char}`       | `;`  | `,`  |
| 在行内查找上一个指定字符 | `F{char}`/`f{char}`       | `;`  | `,`  |
| 在文档中查找下一处匹配项 | `/pattern<CR>`            | `=`  | `-`  |
| 在文档中查找上一处匹配项 | `?pattern<CR>`            | `=`  | `-`  |
| 执行替换                 | `:s/target/replacement/g` | `&`  | `u`  |
| 执行一系列修改           | `qx{change}q`             | `@x` | `u`  |

## 用次数做简单的算术运算

![image-20200625004616744](/home/zzhenry/Boostnote/vim/vim小技巧.assets/image-20200625004616744.png)

![image-20200625004701808](/home/zzhenry/Boostnote/vim/vim小技巧.assets/image-20200625004701808.png)

## 不离开插入模式,粘贴寄存器中的文本

![image-20200626005145413](/home/zzhenry/Boostnote/vim/vim小技巧.assets/image-20200626005145413.png)

## 随时随地做运算

![image-20200626005217600](/home/zzhenry/Boostnote/vim/vim小技巧.assets/image-20200626005217600.png)

## 切换可视选区的活动端

![image-20200626011838589](/home/zzhenry/Boostnote/vim/vim小技巧.assets/image-20200626011838589.png)

## 用面向列块的可视模式编辑表格数据

![image-20200626013056875](/home/zzhenry/Boostnote/vim/vim小技巧.assets/image-20200626013056875.png)

## 在长短不一的高亮块后添加文本

![image-20200626013725180](/home/zzhenry/Boostnote/vim/vim小技巧.assets/image-20200626013725180.png)

### tips 1

![image-20200625005350353](/home/zzhenry/Boostnote/vim/vim小技巧.assets/image-20200625005350353.png)

## 命令行模式

### 操作缓冲区文本的 Ex 命令

| 命令                                            | 用途                                                         |
| ----------------------------------------------- | ------------------------------------------------------------ |
| `:[range]delete [x]`                            | 删除指定范围的行[到寄存器`x`中]                              |
| `:[range]yank [x]`                              | 复制指定范围的行[到寄存器`x`中]                              |
| `:[line]put [x]`                                | 在指定行后粘贴寄存器`x`中的内容                              |
| `:[range]copy {address}`                        | 把指定范围内的行拷贝到`{address}`所指定的行之下              |
| `:[range]move {address}`                        | 把指定范围内的行移动到`{address}`所指定的行之下              |
| `:[range]join`                                  | 连接指定范围内的行                                           |
| `:[range]normal {commands}`                     | 对指定范围内的每一行执行普通模式命令`{commands}`             |
| `:[range]substitute/{pattern}/{string}/[flags]` | 把指定范围内出现`{pattern}`的地方替换为`{string}`            |
| `:[range]global/{pattern}/[cmd]`                | 对指定范围内匹配`{pattern}`的所有行, 在其上执行Ex命令`{cmd}` |

### 定义范围(range)的语法

| 符号          | 地址                        |
| ------------- | --------------------------- |
| `1`           | 文件的第一行                |
| `$`           | 文件的最后一行              |
| `0`           | 虚拟行,位于文件第一行上方   |
| `.`           | 光标所在行                  |
| `'m`          | 包含位置标记m的行           |
| `'<`          | 高亮选区的起始行            |
| `'>`          | 高亮选区的结束行            |
| `%`           | 整个文件 (`:1,$`的简写形式) |
| `{address}+n` | 地址偏移                    |

第0行在文件中并不真实存在, 但它作为一个地址,在某些特定场景下会很有用处. 特别是, 在把指定范围内的行复制或移动到文件开头时, 可以用他作 `:copy {address}` 及 `:move {address}` 命令的最后一个参数.

### 常见的调用外部命令的方式

|          命令          |                        用途                        |
| :--------------------: | :------------------------------------------------: |
|        `:shell`        |          启动一个shell(输入`exit`返回Vim)          |
|       `:!{cmd}`        |                在shell中执行`{cmd}`                |
|     `:read !{cmd}`     | 在shell中执行`{cmd}`, 并把其标注输出插入到光标下方 |
| `:[range]write !{cmd}` |  在shell中执行`{cmd}`, 以`[range]`作为其标准输入   |
|  `:[range]!{filter}`   |     使用外部程序`{filter}`过滤指定的`[range]`      |

Vim 提供了一种方便的快捷方式来设置`:[range]!{filter}`命令中的范围. 我们可以用`!{motion}`操作符切换到命令行模式, 并把指定`{motion}`所涵盖的范围预置在命令行上. 例如, 如果我们把光标移到第2行, 然后执行`!G`, Vim 就会打开命令行并把范围`:.,$!`预置在命令行上. 虽然此后我们仍需输入剩下的`{filter}`命令, 但这毕竟节省了部分工作.

## Normal 模式下命令

- `*` 命令为查找当前单词 (等效于输入 `/\<<C-r><C-w>\><CR>` 序列)

- `daw` 删除整个单词,包括后面的空格

- `dnw` 删除整个单词,不包括后面的空格

- `<C-a>` 对数字执行加操作

- `<C-d>` 对数字执行减操作

- `<C-g>` 显示当前文件名及状态

    ---

- `g~` 反转大小写

- `gu` 转换为小写

- `gU` 转换为大写

    ---

- `q/` 打开查找命令历史的命令行窗口

- `q:` 打开 Ex  命令历史的命令行窗口

    ---

- `<C-w>c` 关闭活动窗口

- `<C-w>o` 只保留活动窗口, 关闭其他所有窗口

- `<C-w>=` 使所有窗口等宽, 等高

- `<C-w>T` 把当前窗口移到一个新的标签页

## Insert 模式下命令

- `<C-h>` 删除前一个字符 (同退格键)
- `<C-w>` 删除前一个单词
- `<C-u>` 删至行首
- `<Esc>` = `<C-[>` 切换到普通模式
- `<C-o>` 切换到插入-普通模式 (在此模式中, 只能执行一个普通模式命令,执行完后,马上返回到插入模式)
- `<C-r>{register}` 访问`{register}`寄存器
- `<C-r>=` 访问 ‘=’ 这一特殊寄存器, 在屏幕下方显示一个提示符, 可在其后面输入要执行的表达式

## Visual 模式下命令

- `gv` 重选上次的高亮选区
- `o` 切换高亮选区的活动端

## 命令行模式

- `<C-f>` 从命令行模式切换到命令行窗口
- `<C-S-c>` 从命令行窗口切换到命令行模式
- `:w !sudo tee % > /dev/null` 以`sudo`权限重新打开缓冲区的命令